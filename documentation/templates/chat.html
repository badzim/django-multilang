{% extends "base.html" %}
{% load i18n %}
{% block title %}Chatbot{% endblock %}
{% block content %}
<h1>{% translate "Chatbot" %}</h1>
<div id="chat-container" class="card">
    <div id="chat-log" class="card-body">
        <!-- Messages will be appended here -->
    </div>
    <div class="card-footer">
        <form id="chat-form" class="d-flex">
            <input type="text" id="chat-input" class="form-control mr-2" placeholder="{% translate 'Ask a question ...' %}" required>
            <button type="submit" class="btn btn-primary">{% translate 'Send' %}</button>
        </form>
    </div>
</div>
<script>
document.getElementById('chat-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const input = document.getElementById('chat-input');
    const message = input.value;
    input.value = '';

    const chatLog = document.getElementById('chat-log');
    chatLog.innerHTML += `<div class="user-message alert alert-primary">${message}</div>`;

    // Simuler la latence de la réponse serveur
    chatLog.innerHTML += `<div class="bot-message alert alert-secondary">...</div>`;

    const response = await fetch('{% url "chatbot" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({ question: message })
    });

    const data = await response.json();
    // Supprimer le "..." et ajouter la réponse réelle
    chatLog.removeChild(chatLog.lastChild);
    chatLog.innerHTML += `<div class="bot-message alert alert-secondary">${data.answer}</div>`;
});
</script>
<style>
#chat-container {
    max-width: 90%;
    margin: 0 auto;
    margin-top: 20px;
}
#chat-log {
    height: 90%;
    overflow-y: scroll;
    padding: 10px;
    border-bottom: 1px solid #dee2e6;
}
.user-message, .bot-message {
    margin-bottom: 10px;
}
</style>
{% endblock %}
